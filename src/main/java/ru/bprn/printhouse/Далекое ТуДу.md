# Далекое "ТуДу" - План развития на основе текущей архитектуры

Этот документ фиксирует идеи по развитию функционала, которые стали возможны благодаря рефакторингу сервиса расчета и внедрению структурированного объекта `FinalCalculation`.

## 1. Модуль расчета доставки

*   **Что нужно:** Для интеграции с API сервисов доставки (СДЭК, Почта России и т.д.) необходим как минимум **общий вес заказа**.
*   **Что у нас есть:** В итоговом объекте `FinalCalculation` есть поле `totalWeight` (в граммах), которое аккумулирует вес всех компонентов заказа.
*   **Оценка:** **Данных достаточно.** Имеющийся `totalWeight` является ключевым параметром для тарификации доставки. В будущем можно будет добавить расчет габаритов упаковки, но основная задача уже решена.

## 2. Модуль производственного планирования

*   **Что нужно:** Понимать, сколько времени займет изготовление заказа, чтобы составлять график загрузки оборудования и сообщать клиенту примерные сроки.
*   **Что у нас есть:**
    1.  `FinalCalculation.totalManufacturingTime`: Общее "чистое" время изготовления. Это хорошая **оценочная** цифра для клиента.
    2.  `List<OperationCalculation>`: Детализация по каждой операции, которая содержит:
        *   `machineTime` и `workerTime` — точное время работы оборудования и сотрудника.
        *   `productOperationId`, по которому можно определить конкретный станок (`AbstractMachine`), задействованный в операции.
*   **Оценка:** **Прекрасная основа.** На базе этих данных можно создать `ProductionPlanningService`, который будет итерировать по всем `OperationCalculation` в заказе и "резервировать" на временной шкале каждого станка отрезки времени, равные `machineTime`. Это позволит построить реальный график загрузки производства.

## 3. Генерация спецификаций и калькуляций (для муниципальных и B2B заказов)

*   **Что нужно:** Детальный, структурированный отчет в формате PDF или для печати, с четкой разбивкой по статьям затрат.
*   **Что у нас есть:** Иерархическая структура `FinalCalculation` -> `ComponentCalculation` -> `OperationCalculation` идеально для этого подходит.
*   **Оценка:** **Данных достаточно.** На основе этой структуры можно легко сгенерировать документ следующего вида:

    ---

    **КАЛЬКУЛЯЦИЯ № 123**
    **Продукт:** Визитка 90х50, 1000 шт.
    **Итоговая стоимость:** `finalPrice`

    **1. Компонент: "Визитка"** (`ComponentCalculation`)
    *   **Основной материал:** `mainMaterial.name` (напр., "Бумага мелованная 300 г/м2")
        *   Стоимость основного материала: `mainMaterialCost`
    *   **Операции:**
        *   **Операция 1: "Цифровая печать"** (`OperationCalculation`)
            *   Стоимость работы оборудования: `machineCost`
            *   Стоимость работы сотрудника: `workerCost`
            *   Стоимость расходных материалов (`consumedMaterial.name`): `materialCost`
            *   **Итого по операции 1:** `totalCost`
        *   **Операция 2: "Резка"** (`OperationCalculation`)
            *   Стоимость работы оборудования: `machineCost`
            *   Стоимость работы сотрудника: `workerCost`
            *   **Итого по операции 2:** `totalCost`
    *   **Себестоимость компонента:** `primeCost`

    **Общая себестоимость заказа:** `FinalCalculation.primeCost`
    **Наценка и налоги:** (`finalPrice` - `primeCost`)