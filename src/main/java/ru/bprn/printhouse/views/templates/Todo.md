# План по реализации обмена шаблонами

Эта функция позволит пользователям экспортировать свои шаблоны в файл и импортировать их в другую инсталляцию приложения.

## 1. Экспорт ("Поделиться")

При экспорте шаблона (`Templates`) необходимо создать единый файл (например, JSON), который будет содержать "пакет шаблона".

### Состав "Пакета шаблона":

1.  **Данные шаблона:**
    *   Полная иерархия `Templates` -> `AbstractProductType` -> `ProductOperation`, включая все их переменные.
    *   Для сериализации можно использовать библиотеку Jackson.

2.  **Манифест зависимостей:**
    *   Список всего, что необходимо для работы этого шаблона на другой системе.
    *   **Оборудование:** Список всех `AbstractMachine`, используемых в операциях (например, по имени и типу).
    *   **Основные материалы:** Список всех `PrintSheetsMaterial`, используемых в продуктах (по имени).
    *   **Расходные материалы операций:** Список всех `PrintingMaterials`, `LaminationFilm` и т.д., используемых в операциях (по имени).

## 2. Импорт ("Добавить к себе")

При импорте файла "пакета шаблона" система выполняет следующие шаги:

1.  **Чтение пакета:** Десериализация JSON-файла в объектную модель (DTO).

2.  **Проверка зависимостей:**
    *   Система итерирует по "манифесту" из пакета.
    *   Для каждой зависимости (оборудование, материал) выполняется поиск в локальной базе данных по имени.

3.  **Принятие решения:**
    *   **Успех (if true):** Если все зависимости из манифеста найдены в локальной БД, можно приступать к установке.
    *   **Неудача:** Если хотя бы одна зависимость не найдена, импорт прерывается. Пользователю выводится информативное сообщение со списком недостающих компонентов (например, "Отсутствует оборудование: 'Konica Minolta C3070'").

4.  **Установка шаблона:**
    *   Создаются новые сущности `Templates`, `AbstractProductType`, `ProductOperation` на основе данных из пакета.
    *   **Важно:** Ссылки на зависимости (машины, материалы) устанавливаются на **существующие локальные** сущности, найденные на шаге 2. Новые сущности зависимостей не создаются.
    *   Вся иерархия сохраняется в базу данных одним каскадным вызовом.

## Техническая реализация

*   **Сериализация:** Использовать библиотеку **Jackson**.
*   **DTO:** Создать классы DTO для представления "пакета шаблона" и его составных частей, чтобы упростить работу с Jackson.